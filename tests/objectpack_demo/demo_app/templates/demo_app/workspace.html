{% extends 'demo_app/master.html' %}

{% block content_head %}


    <script type="text/javascript">

        // Основной объект web-desktop'a
        AppDesktop = new Ext.app.App({
                        // Реализация функции, которая выводит список
                    getModules : function(){
                        return [
                                // Элементы меню "Пуск"
                                {% for menu_item in components.start_menu %}
                                        {% if not forloop.first %},{% endif %}
                            new AppDesktop.MenuItem_{{ forloop.counter }}()
                                {% endfor %}

                                // Значки на рабочем столе
                                {% if components.desktop %},{% endif %}
                                {% for desktop_item in components.desktop %}
                                        {% if not forloop.first %},{% endif %}
                                        new AppDesktop.DesktopItem_{{ forloop.counter }}()
                                {% endfor %}
                {# Включаются элементы верхней панели #}

                                {% if components.start_menu %}
                                ,
                                {% else %}
                                        {% if components.desktop %},{% endif %}
                                {% endif %}

                                // Значки на topbar
                {% for desktop_item in components.toptoolbar %}
                                        {% if not forloop.first %},{% endif %}
                                        new AppDesktop.TopToolbarItem_{{ forloop.counter }}()
                                {% endfor %}
                        ];
                    },

                    // Обязательные настройки меню "Пуск"
                    getStartConfig : function(){
                        return {
                            title: '{{ user }}',
                            toolsPanelWidth: 120,
                            width: 330,
                            iconCls: '{{ user_icon }}',
                            toolItems: [
                                                {% for tool in components.toolbox %}
                                                {% if not forloop.first%},{%endif%}
                                                {% ifequal tool '"-"'%} '-',
                                                {% else %}
                                                        {       text:'{{ tool.name }}'
                                                , iconCls:'{{ tool.icon }}'
                                                , scope:this
                                                                {% if tool.t_is_subitems %}
                                                                , handler: function(){ return false;}
                                                                , menu: {{ tool.render_items|safe }}
                                                                {% else %}
                                                                , handler: function(){
                                                                        return sendRequest('{{ tool.url }}');
                                                                }
                                                                {%endif%}
                                            }
                                                {%endifequal%}
                                                {% endfor %}
                                        ]
                        };
                    }
                });

                {# Обрабатываются модули, находящиеся в меню Пуск #}
                {% for menu_item in components.start_menu %}
                AppDesktop.MenuItem_{{ forloop.counter }} = Ext.extend(Ext.app.Module, {
                    id:'menu-item-{{ forloop.counter }}',
                    init : function(){
                        this.launcher = {
                                        in_start_menu: true
                                        , scope: this
                            , text: '{{ menu_item.name }}'
                            , iconCls: '{{ menu_item.icon }}'
                                        {% if menu_item.t_is_subitems %}
                                        , menu: {{ menu_item.render_items|safe }}
                                        , handler: function(){ return false;}
                                        {% else %}
                                        , handler: function(){
                                                return sendRequest('{{ menu_item.url }}');
                                        }
                                        {%endif%}
                        }
                        }
                });
                {% endfor %}

                {# Обрабатываются модули, находящиеся на Рабочем Столе, не пересекаются с меню Пуск #}
                {% for desktop_item in components.desktop %}
                AppDesktop.DesktopItem_{{ forloop.counter }} = Ext.extend(Ext.app.Module, {
                    id:'desktop-item-{{ forloop.counter }}',
                    init : function(){
                        this.launcher = {
                            text: '{{ desktop_item.name }}',
                            iconCls:'{{ desktop_item.icon }}',
                            handler : function(){
                                                return sendRequest('{{ desktop_item.url }}');
                                        },
                            scope: this
                        }
                    }
                });
                {% endfor %}

        {# Элементы верхней панельки (topbara) #}
            {% for toptoolbar_item in components.toptoolbar %}
                AppDesktop.TopToolbarItem_{{ forloop.counter }} = Ext.extend(Ext.app.Module, {
                    id:'toptoolbar-item-{{ forloop.counter }}',
                    init : function(){
                        this.launcher = {
                    index: '{{ toptoolbar_item.index }}',
                            text: '{{ toptoolbar_item.name }}',
                            iconCls:'{{ toptoolbar_item.icon }}',
                            scope: this
                            {% if toptoolbar_item.t_is_subitems %}
                                , menu: {{ toptoolbar_item.render_items|safe }}
                                , handler: function(){ return false;}
                            {% else %}
                                , handler: function(){
                                    return sendRequest('{{ toptoolbar_item.url }}');
                                }
                            {%endif%}
				  {% if toptoolbar_item.ui_object %}
				    , ui_object:{{ toptoolbar_item.t_render_ui_object|safe}}
				  {%endif%}
                        }
                    }
                });
            {% endfor %}
        </script>
{% endblock %}

{% block content %}
        <!-- Верхняя панель -->
        <div id="ux-toptoolbar"></div>

        <!-- Верхняя панель -->
        <div id="x-desktop">
                <table id="x-shortcuts">
                        <tr>
                                <!-- Иконки в десктопе -->
                                {% for desktop_item in components.desktop %}
                                <td id="desktop-item-{{ forloop.counter }}-shortcut">
                                        <a href="#">
                                                <div class="base-desktop-image {{ desktop_item.icon }}"> </div>
                                        <div class="desktop-item-shortcut-label">{{ desktop_item.name }}</div>
                                        </a>
                                </td>
                                {% endfor %}
                        </tr>
                </table>

        </div>

        <!-- Нижняя панель и меню пуск -->
        <div id="ux-taskbar">
                <div id="ux-taskbar-start"></div>
                <div id="ux-taskbuttons-panel"></div>
                <div class="x-clear"></div>
        </div>
{% endblock %}
